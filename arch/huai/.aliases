#!/bin/bash
export SSH_AUTH_SOCK="$XDG_RUNTIME_DIR/ssh-agent.socket"
export MAILCAPS="$HOME/.config/mutt/mailcap"
export GPG_TTY=$(tty)
export LANG=en_US.UTF-8
export VISUAL=vim
export EDITOR=vim
export TERM=xterm-256color
umask 022
# 通用别名配置文件
# 可以被 .bashrc 和 .zshrc 同时引用

# 基础系统命令
alias ls='ls --color=auto'
alias grep='grep --color=auto'
alias c="clear"
alias ..='cd ..'
alias ~='cd ~'

# 系统操作
alias update="sudo pacman -Syyu"
alias P="sleep 60 && shutdown now"
alias R="systemctl reboot"
alias rsyncdir="rsync -avzh --delete"  # 同步目录，删除目标端多余文件

# 配置文件编辑
alias zshconfig="vim ~/.zshrc"
alias bashconfig="vim ~/.bashrc"

# 目录导航
alias cdconfig="cd /home/huai/.config"
alias cdfree="cd /workspace/free"
alias cdlinux="cd /workspace/linux"
alias cddata="mount-data; cd /data"
alias cdappdata="mount-data; cd /data/appdata"
alias cdusb="cd /home/huai/usb"
alias cdwww="mount-data; cd /data/www"
alias cdmedia="mount-data; cd /data/media"
alias cdmutt="cd /home/huai/.config/mutt"

# 音频控制
alias 0="pactl set-default-sink alsa_output.usb-DeSheng_Electronics_Inc._Star_Y360-00.analog-stereo"
alias 1="pactl set-default-sink alsa_output.usb-Generic_USB2.0_Device_20130100ph0-00.analog-stereo"

vol() {
    pactl set-sink-volume @DEFAULT_SINK@ "${1}%"
    local PID_FILE="${XDG_RUNTIME_DIR}/dwl_status.pid"
    local SIGNAL_NUM=36 # SIGRTMIN+2
    if [ -f "$PID_FILE" ]; then
        kill -"$SIGNAL_NUM" "$(cat "$PID_FILE")"
    fi
}
alias volup="vol +10%"
alias voldown="vol -10%"
alias volmute="pactl set-sink-mute @DEFAULT_SINK@ toggle"

# MPD控制
alias s="mpc stop"
alias p="mpc play"
alias nm="mpc next"
alias mpause="mpc pause"
alias pl="vim /home/huai/.config/mpd/playlists/all.m3u"

# 远程连接
alias nas="ssh_add_check; ssh huai@192.168.31.21"
alias cloud="ssh_add_check; ssh root@ssh.202309.xyz"
alias sing-boxupload="ssh_add_check; rsync -avzh --delete /workspace/free/sing-box/ root@ssh.202309.xyz:/root/sing-box/"
alias clashupload="ssh_add_check; rsync -avzh --delete /workspace/free/clash/ root@ssh.202309.xyz:/root/clash/"
alias openwrt="ssh_add_check; ssh root@192.168.31.1"
alias ax6s="ssh_add_check; ssh root@192.168.31.2"

# Git相关
alias gaa='git add -A'
alias gc='git commit -v'
alias gpl='ssh_add_check; git pull'
alias gcl='ssh_add_check; git clone'
# 用于 codeberg 的推送函数
codeberg() {
  # 首先执行 ssh_add_check 命令
  ssh_add_check
  
  # 检查函数调用时是否附加了参数
  if [ $# -eq 0 ]; then
    # 如果没有参数 ($# 等于 0), 则默认推送 'main' 分支
    git push codeberg main
  else
    # 如果有参数, 则将所有参数 ("$@") 传递给 git push 命令
    git push codeberg "$@"
  fi
}

# 用于 github 的推送函数
github() {
  # 首先执行 ssh_add_check 命令
  ssh_add_check
  
  # 检查函数调用时是否附加了参数
  if [ $# -eq 0 ]; then
    # 如果没有参数 ($# 等于 0), 则默认推送 'main' 分支
    git push github main
  else
    # 如果有参数, 则将所有参数 ("$@") 传递给 git push 命令
    git push github "$@"
  fi
}
# 检查 SSH 代理并自动添加密钥
ssh_add_check() {
    if [ -z "$(ssh-add -l 2>/dev/null | grep -v 'The agent has no identities.')" ]; then
	ssh-add <(gpg -d /home/huai/.ssh/id_ed25519.gpg) 
    fi
}
# 为 /data 目录创建的 NFS 挂载函数 (静默版)
mount-data() {
    if ! mountpoint -q /data; then
        sudo mount -t nfs4 -o sec=sys 192.168.31.21:/ /data
    fi
}

# 脚本和程序
alias x="sh /home/huai/.config/dwl/dwl_status.sh | dwl"
alias win="sh /home/huai/.config/windows.sh"
alias repo="sh /home/huai/.config/repo.sh"
alias np="sh /home/huai/.config/swww.sh"
alias py="python3"
